x86-64, ubuntu 24.04 编译 qt 6.8.3 源代码
2025.10.12 更新， xory.corp@outlook.com
#没有编译 QtWebEngine, QtPdf 模块
#多媒体支持
Qt Multimedia:
  Spatial Audio .......................... yes
  Spatial Audio (Quick3D) ................ yes
  Low level Audio Backend:
    ALSA (experimental) .................. no
    PulseAudio ........................... yes
    MMRenderer ........................... no
    CoreAudio ............................ no
    Windows Media SDK .................... no
    Open SLES (Android) .................. no
    Web Assembly ......................... no
  Plugin:
    QtMM GStreamer plugin ................ yes
    FFmpeg ............................... yes
    FFmpeg plugin features:
      PipeWire screen capture ............ no
    MMRenderer ........................... no
    AVFoundation ......................... no
    Windows Media Foundation ............. no
    Native Android backend (deprecated) .. no
  Hardware acceleration and features:
    Video for Linux ...................... yes
    VAAPI support ........................ yes
    Linux DMA buffer support ............. yes
    VideoToolbox ......................... no
  
###    

1. 安装必要的组件
1.0 升级系统组件
  sudo apt upate && sudo apt upgrade -y
  sudo reboot
  
1.1 解决自动息屏唤醒后黑屏的问题
# https://askubuntu.com/questions/1515938/how-to-fix-freezing-ubuntu-24-04-on-vmware-and-enable-accelerated-graphics
sudo add-apt-repository ppa:oibaf/graphics-drivers
sudo apt update && sudo apt upgrade

1.2 安装网络工具和 ssh 服务
	sudo apt install -y net-tools ssh
	
1.3 解决复制粘贴不能共享的问题
sudo apt purge open-vm-tools open-vm-tools-desktop -y
sudo apt autoremove -y
sudo apt install open-vm-tools open-vm-tools-desktop -y
sudo reboot


1.4 安装开发工具
sudo apt install -y cmake g++ ninja-build clang-18 libclang-18-dev llvm-18
#交叉编译工具，不需要则不装
 sudo apt install -y gcc-aarch64-linux-gnu g++-aarch64-linux-gnu


#2. 编译 qt 6.8.3 源代码
2.1. 安装官方文档所需要的工具
sudo apt install -y \
    libfontconfig1-dev \
    libfreetype-dev \
    libgtk-3-dev \
    libx11-dev \
    libx11-xcb-dev \
    libxcb-cursor-dev \
    libxcb-glx0-dev \
    libxcb-icccm4-dev \
    libxcb-image0-dev \
    libxcb-keysyms1-dev \
    libxcb-randr0-dev \
    libxcb-render-util0-dev \
    libxcb-shape0-dev \
    libxcb-shm0-dev \
    libxcb-sync-dev \
    libxcb-util-dev \
    libxcb-xfixes0-dev \
    libxcb-xkb-dev \
    libxcb1-dev \
    libxext-dev \
    libxfixes-dev \
    libxi-dev \
    libxkbcommon-dev \
    libxkbcommon-x11-dev \
    libxrender-dev

2.2. 安装低级音频模块后端
sudo apt install -y \
  libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libpulse-dev
  
2.2.1 安装多媒体后端，ffmpeg 和 gstreamer
  sudo apt install -y \
    libavcodec-dev libavformat-dev libavutil-dev libswresample-dev libswscale-dev \
    libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev \
    libgstreamer-plugins-good1.0-dev libgstreamer-plugins-bad1.0-dev
    
2.2.2 支持 vapi，可选
   sudo apt install -y libva-dev libva-drm2 libva-x11-2 libvdpau-dev 
   
2.2.3 #查询 VA API 支持
  sudo apt install -y vainfo
 

2.3. 安装 html5lib nodejs, 如果不编译 qtwebengine，可以不用安装
sudo apt install python3-html5lib nodejs

2.4. 根据chatgpt给的建议, 安装支持库
sudo apt install -y libdrm-dev libpciaccess-dev libxcb-xinerama0 \
  libxcb-xinerama0-dev libxkbfile-dev libxshmfence-dev \
  libsqlite3-dev libssl-dev libudev-dev libhunspell-dev

2.5. 配置
   创建 build-qt-6.8，进入后运行以下命令行，根据情况加 sudo
  ../qt-everywhere-src-6.8.3/configure \
  -prefix /opt/qt-6.8-x64 -nomake examples -nomake tests \
  -- -DCMAKE_BUILD_WITH_INSTALL_RPATH=ON -DCMAKE_BUILD_TYPE=Release 
  

2.6. 编译，根据情况加 sudo
Qt is now configured for building. Just run 'cmake --build . --parallel'

Once everything is built, you must run 'cmake --install .'
Qt will be installed into '/opt/qt-6.8-x64'

To configure and build other Qt modules, you can use the following convenience script:
        /opt/qt-6.8-x64/bin/qt-configure-module

安装好了以后，
In .profile (if your shell is bash, ksh, zsh or sh), add the following lines:

PATH=/opt/qt-6.8-x64/bin:$PATH
export PATH

In .login (if your shell is csh or tcsh), add the following line:

setenv PATH /opt/qt-6.8-x64/bin:$PATH

2.7 单独编译模块
   以重新编译 qtmultimedia 模块以支持 vaapi 插件为例子
   创建目录 qt-6.8-x64-qtmultimedia-build
   mkdir qt-6.8-x64-qtmultimedia-build && cd qt-6.8-x64-qtmultimedia-build
   sudo apt install -y libva-dev libva-drm2 libva-x11-2 libvdpau-dev 
   /opt/qt-6.8-x64/bin/qt-configure-module ../qt-everywhere-src-6.8.3/qtmultimedia
   #也可以通过 FFMPEG_DIR 指定 ffmepg 路径
   #/opt/qt-6.8-x64/bin/qt-configure-module ../qt-everywhere-src-6.8.3/qtmultimedia/ FFMPEG_DIR=/opt/ffmpeg-6.1.3
   cmake --build . --parallel
   sudo cmake --install .

#3. 编译 qt cmake 工程 qmlAllInOne
   cd qmlAllInOne
   mkdir build
   cd build/
   cmake -S .. -DCMAKE_PREFIX_PATH=/opt/qt-6.8-x64 -DCMAKE_BUILD_TYPE=Release
   cmake --build . --parallel
   ./appqmlAllInOne

11. 打包
需要提供 .desktop 文件和程序图标
sudo apt install libfuse2
wget https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImage
chmod +x linuxdeployqt-continuous-x86_64.AppImage
sudo mv linuxdeployqt-continuous-x86_64.AppImage /usr/local/bin/linuxdeployqt


cd build
./appqmlAllInOne  # 确保能本地运行

linuxdeployqt ./appqmlAllInOne -qmldir=../qml -appimage -unsupported-allow-new-glibc